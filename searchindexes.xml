<?xml version="1.0" encoding="utf-8" standalone="yes"?><search><entry><title>Openwrt软路由配置（二）：使用Nginx支持内网服务通过HTTPS访问</title><url>/blog/openwrt-access-by-https/</url><categories><category>技术</category></categories><tags><tag>Openwrt</tag><tag>Nginx</tag><tag>Https</tag></tags><content type="html">  在文章 Openwrt软路由配置（一）：使用家庭宽带支持IPv4+IPv6双栈访问 的最后章节，提到当内网部署了多个http服务时，通过不同域名+固定端口进行访问会更加方便易用。同时在提供外部访问时，如果可以将本地 HTTP 服务自动转换为 HTTPS 服务，也可以大幅改善内网服务的安全性。 这两个需求可以用Nginx反向代理来实现。
Openwrt使用Nginx有两种方式：
通过docker部署Nginx Proxy Manager来进行可视化操作，这种方式最为简便。如果家里路由的性能不太够，又或者路由芯片没有相应的docker镜像，这种方式就不太适用。 Openwrt直接使用Nginx替代默认的uhttpd来作为Web服务器。这种方式需要一些配置，Openwrt上也没有好用的Nginx管理界面，所以需要一些命令行操作。但在灵活性和性能上会更有优势。 方式1网上的教程较多，可以参见 NAS必备神器：部署中文版反向代理工具『Nginx Proxy Manager』并申请 SSL 证书 。 这里我们按照方式2的思路操作一遍，顺带熟悉一下Nginx的使用。 准备工作 Openwrt中安装acme-acmesh-dnsapi、luci-app-acme、luci-ssl-nginx这几个软件包。 准备好Cloudflare的区域ID和API令牌。 配置步骤 一、申请自己域名的ssl证书
打开Openwrt管理界面，到ACME证书界面添加真实的电子邮件账户，在证书配置处输入证书名称并点击添加。 编辑刚刚新增的证书配置。选中【已启用】，添加自己要申请的【域名】。这里因为ACME支持泛域名申请，我们可以写上比如*.example.com这样的域名申请信息。当然申请*.test.example.com这样的三级域名也是可以的，但Cloudflare默认提供的免费证书只支持根域名example.com以及二级泛域名*.example.com，三级及以上的域名会报证书错误。所以我们这里其实没有必要申请多级域名的证书。 在【质询验证】选项里选择【验证方式】为DNS，【DNS_API】填入dns_cf，DNS API 为域名解析商，具体的值可以在 https://github.com/acmesh-official/acme.sh/wiki/dnsapi 查询。 DNS_API凭证填入： …  </content></entry><entry><title>Openwrt软路由配置（一）：使用家庭宽带支持IPv4+IPv6双栈访问</title><url>/blog/openwrt-access-by-ipv6/</url><categories><category>技术</category></categories><tags><tag>Openwrt</tag><tag>IPv6</tag></tags><content type="html">  家用宽带一般不会分配IPV4公网地址，普通路由器自带的DDNS服务也就没法使用。好在目前国内 IPv6 的成熟度足够高，手机网络和家庭宽带通常都是默认分配 IPv6 地址的，因此可以考虑改用支持 IPv6 的 DDNS 服务来实现家庭设备的公网远程访问。 但在这种情况下，设备只有通过支持IPv6的网络才能被访问，普通的IPv4网络（例如酒店的wifi或者公司网络）是无法正常访问的，除非使用内网穿透或者类似IPv6to4的隧道服务。
这里需要提一下内网穿透。内网穿透的本质是让内网设备持续主动访问某个拥有固定公网IP地址的服务器，再由这台公网服务器将网络访问请求转发至内网设备，从而建立起和内网设备的传输通道。从技术技术细节上还可以分为服务器中转数据穿透和P2P穿透，可以参见 内网穿透详解 - cyrus0w - 博客园 。大家通常用的花生壳、向日葵、ToDesk、TeamViewer就是属于这类技术。其优缺点也很明显，商用的穿透服务一般带宽受限且收费，自建的如frp、n2n虽然带宽独占，但又需要自行购置VPS和配置服务，对于家庭使用仍是不便。 那么有没有一种办法即免费又能安全方便的实现家庭宽带的IPv4+IPv6双栈访问？当然是有的，这就不得不提到“赛博菩萨”Cloudflare。
准备工作 购买一个域名，并托管到Cloudflare。 家里的宽带需要支持分配IPV6地址，可以访问https://ipw.cn/来验证。具体的配置过程可以参见 不良林的IPv6教程 ，这里不详述。 配置步骤 一、把自己域名托管到Cloudflare
账号主页&amp;amp;ndash;》添加域 填上自己的域名example.com，点击继续 选择免费的套餐即可 根据提示去你的域名服务商更改DNS 我的域名是spaceship注册的，需要打开Launchpad&amp;amp;ndash;》域管理器，填入Cloudflare分配的DNS服务器。 等待DNS托管完成 二、OpenWrt配置DDNS 家庭IPv6分配的地址一般为公网IP，所以可以从公网访问。但分配到的IPv6地址会经常变动，所以要通过DDNS插件自动把最新的IPv6地址解析到固定的域名上。这里我们直接用Cloudflare的API接口来实现DDNS服务。顺带说一句，如果自己没有购买域名，使用dynv6.com提供的免费DDNS服务也是可以支持IPv6访问的， …  </content></entry><entry><title>网络服务器设计原理及分析</title><url>/blog/network-server-design/</url><categories><category>技术</category></categories><tags><tag>服务器</tag><tag>事件驱动</tag></tags><content type="html">  在网络服务端编程中，服务器需要处理多个客户端的请求。为了提高性能，服务器通常会使用多种手段并发处理这些请求。基于非阻塞IO和事件驱动的并发机制可能是编写用户态高性能网络程序最成熟的模式。
操作系统基础 用户空间与内核空间 操作系统都采用虚拟存储器，系统可访问的虚拟存储空间就是系统自身的寻址空间，例如32位操作系统对应4G（2的32次方）的寻址空间。操作系统通过内核（kernel）访问底层硬件设备，用户进程则由内核进行调度管理。为了保证用户进程不直接操作内核，系统将虚拟存储空间分为内核空间和用户空间两部分。针对32位linux操作系统而言，将最高的1G字节（虚拟地址0xC0000000-0xFFFFFFFF）分配为内核空间，较低的3G字节（虚拟地址0x00000000-0xBFFFFFFF）分配为用户空间。
进程切换 内核进行进程切换时，主要有下列处理过程：
保存处理机上下文，包括程序计数器和其他寄存器。 更新内核空间中的PCB（进程控制块Process Control Block）信息。 把进程的PCB移入相应的队列，如就绪、某事件阻塞等队列。 选择另一个进程执行，并更新其PCB。 更新内存管理的数据结构。 恢复处理机上下文。 总而言之，进程切换很耗费资源。
进程有就绪、运行、阻塞三种基本状态。正在运行的进程，会因为请求系统资源失败、等待操作完成、新数据未到达或无新工作做等原因由系统自动执行阻塞原语（Block），使自己从运行状态变为阻塞状态，从而退出CPU资源的占用。
文件描述符 当程序打开现有文件或新建文件时，内核会维护一个该进程打开文件的记录表，并通过文件描述符（File Descriptor）来对该文件记录表进行索引。一些涉及底层I/O的程序编写往往会围绕文件描述符展开。
缓存I/O 当程序进行I/O访问操作时，操作系统会先将I/O的数据缓存到文件系统的页缓存（Page Cache）中，也就是说，数据会先被拷贝到操作系统的内核缓冲区中，再从内核缓冲区拷贝到应用程序的地址空间。因为缓存I/O机制的存在，数据在传输过程中需要在用户空间和内核空间进行多次数据拷贝操作，这些数据拷贝操作所带来的CPU及内存开销通常是很大的。以I/O的read操作为例，会经历两个阶段：
等待数据就绪 将数据从内核空间拷贝到用户进程空间中 围绕这两个阶段，Linux系统产生了下面五种网络 …  </content></entry><entry><title/><url>/archives/_index.en-us/</url><categories/><tags/><content type="html">    </content></entry><entry><title>关于</title><url>/about.html</url><categories/><tags/><content type="html">  人话版描述：
一个碳基生物的思维记录。 对技术原理有强烈的求知欲，着迷于技术革命导致的生产关系重构。 一些神叨叨的感兴趣主题：语言、维度、概率、混沌。 病理学描述：
一个碳基生物的思维病理学切片。 以人类形态执行「技术人类学」田野调查项目，研究重点包括：碳基生存焦虑、维度暴力、概率风暴、狄拉克海真空涨落。 碳基生物试图突破语言洛希极限时喷溅的认知星尘。   </content></entry></search>